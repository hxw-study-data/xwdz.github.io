<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Android关于LayoutInflater加载布局导致布局宽高失效 | 酸菜</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android关于LayoutInflater加载布局导致布局宽高失效</h1><a id="logo" href="/.">酸菜</a><p class="description">xwdz，未来路很长</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android关于LayoutInflater加载布局导致布局宽高失效</h1><div class="post-meta">Feb 26, 2018<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h3 id="为何宽高失效？"><a href="#为何宽高失效？" class="headerlink" title="为何宽高失效？"></a>为何宽高失效？</h3><p>想要实现如下效果只需要一个recyclerView里面一个textView即可。<br><img src="http://upload-images.jianshu.io/upload_images/2651056-283dc99b6230ecd9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>Adapter 代码</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">static <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter&lt;MyAdapter</span>.<span class="title">MyHolder&gt;</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="type">Context</span> mContext;</div><div class="line">        <span class="keyword">private</span> <span class="type">List</span>&lt;<span class="type">String</span>&gt; mStrings = <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;&gt;();</div><div class="line"></div><div class="line">        public <span class="type">MyAdapter</span>(<span class="type">Context</span> context) &#123;</div><div class="line">            mContext = context;</div><div class="line">            <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</div><div class="line">                mStrings.add(<span class="string">""</span> + i);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        public <span class="type">MyHolder</span> onCreateViewHolder(<span class="type">ViewGroup</span> parent, int viewType) &#123;</div><div class="line">            <span class="type">View</span> view = <span class="type">LayoutInflater</span>.from(mContext).inflate(<span class="type">R</span>.layout.item_list, <span class="literal">null</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">MyHolder</span>(view);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        public void onBindViewHolder(<span class="type">MyHolder</span> holder, int position) &#123;</div><div class="line">            holder.mTextView.setText(mStrings.get(position));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        public int getItemCount() &#123;</div><div class="line">            <span class="keyword">return</span> mStrings.size();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        static <span class="class"><span class="keyword">class</span> <span class="title">MyHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">            <span class="type">TextView</span> mTextView;</div><div class="line"></div><div class="line">            public <span class="type">MyHolder</span>(<span class="type">View</span> itemView) &#123;</div><div class="line">                <span class="keyword">super</span>(itemView);</div><div class="line"></div><div class="line">                mTextView = itemView.findViewById(<span class="type">R</span>.id.text);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>xml文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"@android:color/black"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/text"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">"12dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@android:color/white"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"123123"</span>/&gt;</span></div><div class="line">   </div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>可是实现的效果是这样的</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2651056-fcc4f491e0264de5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>可以看到宽明明是match _ parent但是在这里却变成了wrap_content,即文本长度多长，textView宽度都宽，为什么会失效呢？</p>
<p>首先一个View的宽高padding什么的失我第一个想到的就是LayoutParams，因为一些xml里面属性都在LayoutParams里面，如果失效了估计是LayoutParams没有set上去。</p>
<hr>
<h3 id="关于LayoutInflater"><a href="#关于LayoutInflater" class="headerlink" title="关于LayoutInflater"></a>关于LayoutInflater</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">LayoutInflater</span><span class="selector-class">.from</span>(<span class="selector-tag">mContext</span>)<span class="selector-class">.inflate</span>(<span class="selector-tag">R</span><span class="selector-class">.layout</span><span class="selector-class">.item_list</span>, <span class="selector-tag">null</span>);</div><div class="line"></div><div class="line"><span class="selector-tag">LayoutInflater</span><span class="selector-class">.from</span>(<span class="selector-tag">mContext</span>)<span class="selector-class">.inflate</span>(<span class="selector-tag">R</span><span class="selector-class">.layout</span><span class="selector-class">.item_list</span>,<span class="selector-tag">parent</span>, <span class="selector-tag">false</span>);</div></pre></td></tr></table></figure>
<p>以上是最为普通使用LayoutInflater加载Layout方式，上面的列子中如果使用了3个参数的方法来加载Layout，也就解决了宽度问题，搞懂了2个参数和3个参数方法的区别也就明白了。</p>
<p>代码如下</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">        <span class="keyword">public</span> <span class="function">MyHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">            View view = LayoutInflater.from(mContext).inflate(R.layout.item_list, parent, <span class="keyword">false</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MyHolder(view);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>如上也就解决了宽度失效问题，可是为什么呢？</p>
<p>源码</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">    * Inflate a new view hierarchy from the specified xml resource. Throws</span></div><div class="line"><span class="comment">    * &#123;@link InflateException&#125; if there is an error.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param resource ID for an XML layout resource to load (e.g.,</span></div><div class="line"><span class="comment">    *        &lt;code&gt;R.layout.main_page&lt;/code&gt;)</span></div><div class="line"><span class="comment">    * @param root Optional view to be the parent of the generated hierarchy.</span></div><div class="line"><span class="comment">    * @return The root View of the inflated hierarchy. If root was supplied,</span></div><div class="line"><span class="comment">    *         this is the root View; otherwise it is the root of the inflated</span></div><div class="line"><span class="comment">    *         XML file.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="selector-tag">public</span> <span class="selector-tag">View</span> <span class="selector-tag">inflate</span>(<span class="variable">@LayoutRes</span> int resource, <span class="variable">@Nullable</span> ViewGroup root) &#123;</div><div class="line">       <span class="selector-tag">return</span> <span class="selector-tag">inflate</span>(resource, root, root != null);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>本质上2个参数的方法也是调用了3个参数的方法。<br>三个参数源码如下</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">    * Inflate a new view hierarchy from the specified xml resource. Throws</span></div><div class="line"><span class="comment">    * &#123;<span class="doctag">@link</span> InflateException&#125; if there is an error.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> resource ID for an XML layout resource to load (e.g.,</span></div><div class="line"><span class="comment">    *        &lt;code&gt;R.layout.main_page&lt;/code&gt;)</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> root Optional view to be the parent of the generated hierarchy (if</span></div><div class="line"><span class="comment">    *        &lt;em&gt;attachToRoot&lt;/em&gt; is true), or else simply an object that</span></div><div class="line"><span class="comment">    *        provides a set of LayoutParams values for root of the returned</span></div><div class="line"><span class="comment">    *        hierarchy (if &lt;em&gt;attachToRoot&lt;/em&gt; is false.)</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> attachToRoot Whether the inflated hierarchy should be attached to</span></div><div class="line"><span class="comment">    *        the root parameter? If false, root is only used to create the</span></div><div class="line"><span class="comment">    *        correct subclass of LayoutParams for the root view in the XML.</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> The root View of the inflated hierarchy. If root was supplied and</span></div><div class="line"><span class="comment">    *         attachToRoot is true, this is root; otherwise it is the root of</span></div><div class="line"><span class="comment">    *         the inflated XML file.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">public</span> <span class="function">View <span class="title">inflate</span><span class="params">(@LayoutRes <span class="keyword">int</span> resource, @Nullable ViewGroup root, <span class="keyword">boolean</span> attachToRoot)</span> </span>&#123;</div><div class="line">       <span class="keyword">final</span> Resources res = getContext().getResources();</div><div class="line">       <span class="keyword">if</span> (DEBUG) &#123;</div><div class="line">           Log.d(TAG, <span class="string">"INFLATING from resource: \""</span> + res.getResourceName(resource) + <span class="string">"\" ("</span></div><div class="line">                   + Integer.toHexString(resource) + <span class="string">")"</span>);</div><div class="line">       &#125;</div><div class="line">	<span class="comment">//解析xml</span></div><div class="line">       <span class="keyword">final</span> XmlResourceParser parser = res.getLayout(resource);</div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">       <span class="comment">//inflate的地方</span></div><div class="line">           <span class="function"><span class="keyword">return</span> <span class="title">inflate</span><span class="params">(parser, root, attachToRoot)</span></span>;</div><div class="line">       &#125; <span class="keyword">finally</span> &#123;</div><div class="line">           parser.close();</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">    * Inflate a new view hierarchy from the specified XML node. Throws</span></div><div class="line"><span class="comment">    * &#123;@link InflateException&#125; if there is an error.</span></div><div class="line"><span class="comment">    * &lt;p&gt;</span></div><div class="line"><span class="comment">    * &lt;em&gt;&lt;strong&gt;Important&lt;/strong&gt;&lt;/em&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;For performance</span></div><div class="line"><span class="comment">    * reasons, view inflation relies heavily on pre-processing of XML files</span></div><div class="line"><span class="comment">    * that is done at build time. Therefore, it is not currently possible to</span></div><div class="line"><span class="comment">    * use LayoutInflater with an XmlPullParser over a plain XML file at runtime.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param parser XML dom node containing the description of the view</span></div><div class="line"><span class="comment">    *        hierarchy.</span></div><div class="line"><span class="comment">    * @param root Optional view to be the parent of the generated hierarchy (if</span></div><div class="line"><span class="comment">    *        &lt;em&gt;attachToRoot&lt;/em&gt; is true), or else simply an object that</span></div><div class="line"><span class="comment">    *        provides a set of LayoutParams values for root of the returned</span></div><div class="line"><span class="comment">    *        hierarchy (if &lt;em&gt;attachToRoot&lt;/em&gt; is false.)</span></div><div class="line"><span class="comment">    * @param attachToRoot Whether the inflated hierarchy should be attached to</span></div><div class="line"><span class="comment">    *        the root parameter? If false, root is only used to create the</span></div><div class="line"><span class="comment">    *        correct subclass of LayoutParams for the root view in the XML.</span></div><div class="line"><span class="comment">    * @return The root View of the inflated hierarchy. If root was supplied and</span></div><div class="line"><span class="comment">    *         attachToRoot is true, this is root; otherwise it is the root of</span></div><div class="line"><span class="comment">    *         the inflated XML file.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="function"><span class="keyword">public</span> View <span class="title">inflate</span>(<span class="params">XmlPullParser parser, @Nullable ViewGroup root, boolean attachToRoot</span>) </span>&#123;</div><div class="line">       synchronized (mConstructorArgs) &#123;</div><div class="line">          		... 省略部分代码</div><div class="line">          		</div><div class="line">               <span class="keyword">if</span> (DEBUG) &#123;</div><div class="line">                   System.<span class="keyword">out</span>.println(<span class="string">"**************************"</span>);</div><div class="line">                   System.<span class="keyword">out</span>.println(<span class="string">"Creating root view: "</span></div><div class="line">                           + name);</div><div class="line">                   System.<span class="keyword">out</span>.println(<span class="string">"**************************"</span>);</div><div class="line">               &#125;</div><div class="line">				<span class="comment">// 判断是否是merge标签</span></div><div class="line">               <span class="keyword">if</span> (TAG_MERGE.<span class="keyword">equals</span>(name)) &#123;</div><div class="line">                   <span class="keyword">if</span> (root == <span class="literal">null</span> || !attachToRoot) &#123;</div><div class="line">                       <span class="keyword">throw</span> <span class="keyword">new</span> InflateException(<span class="string">"&lt;merge /&gt; can be used only with a valid "</span></div><div class="line">                               + <span class="string">"ViewGroup root and attachToRoot=true"</span>);</div><div class="line">                   &#125;</div><div class="line"></div><div class="line">                   rInflate(parser, root, inflaterContext, attrs, <span class="literal">false</span>);</div><div class="line">               &#125; <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">                   <span class="comment">// Temp is the root view that was found in the xml</span></div><div class="line">                   final View temp = createViewFromTag(root, name, inflaterContext, attrs);</div><div class="line">					<span class="comment">// 关键点</span></div><div class="line">                   ViewGroup.LayoutParams <span class="keyword">params</span> = <span class="literal">null</span>;</div><div class="line">					<span class="comment">// parent 是否为空</span></div><div class="line">                   <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</div><div class="line">                       <span class="keyword">if</span> (DEBUG) &#123;</div><div class="line">                           System.<span class="keyword">out</span>.println(<span class="string">"Creating params from root: "</span> +</div><div class="line">                                   root);</div><div class="line">                       &#125;</div><div class="line">                       <span class="comment">// Create layout params that match root, if supplied</span></div><div class="line">				       <span class="comment">// 创建跟布局的LayoutParams</span></div><div class="line">                       <span class="keyword">params</span> = root.generateLayoutParams(attrs);</div><div class="line">						<span class="comment">// 是否为false 如果是flase则添加到view里面</span></div><div class="line">                       <span class="keyword">if</span> (!attachToRoot) &#123;</div><div class="line">                           <span class="comment">// Set the layout params for temp if we are not</span></div><div class="line">                           <span class="comment">// attaching. (If we are, we use addView, below)</span></div><div class="line">                           temp.setLayoutParams(<span class="keyword">params</span>);</div><div class="line">                       &#125;</div><div class="line">                   &#125;</div><div class="line"></div><div class="line">                   <span class="keyword">if</span> (DEBUG) &#123;</div><div class="line">                       System.<span class="keyword">out</span>.println(<span class="string">"-----&gt; start inflating children"</span>);</div><div class="line">                   &#125;</div><div class="line"></div><div class="line">                   <span class="comment">// Inflate all children under temp against its context.</span></div><div class="line">                   rInflateChildren(parser, temp, attrs, <span class="literal">true</span>);</div><div class="line"></div><div class="line">                   <span class="keyword">if</span> (DEBUG) &#123;</div><div class="line">                       System.<span class="keyword">out</span>.println(<span class="string">"-----&gt; done inflating children"</span>);</div><div class="line">                   &#125;</div><div class="line"></div><div class="line">                   <span class="comment">// We are supposed to attach all the views we found (int temp)</span></div><div class="line">                   <span class="comment">// to root. Do that now.</span></div><div class="line">                   <span class="comment">// 注意到这里如果是true 则会将其View添加到root里面</span></div><div class="line">                   <span class="keyword">if</span> (root != <span class="literal">null</span> &amp;&amp; attachToRoot) &#123;</div><div class="line">                       root.addView(temp, <span class="keyword">params</span>);</div><div class="line">                   &#125;</div><div class="line"></div><div class="line">                   <span class="comment">// Decide whether to return the root that was passed in or the</span></div><div class="line">                   <span class="comment">// top view found in xml.</span></div><div class="line">                   <span class="keyword">if</span> (root == <span class="literal">null</span> || !attachToRoot) &#123;</div><div class="line">                       result = temp;</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">			          ... 省略部分代码</div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p><strong>注意看到判断是否MERGE的else分支，里面关键的地方都已经写上注释。</strong></p>
<p><strong>其实也就是说，如果root不是空的话，回去创建LayoutParams，在判断如果attchToRoot参数如果是false，则会setLayoutParams到View里面去。</strong></p>
<p>文章的开头有说到LayoutParams这个类，里面都是一个在xml声明的属性，那我们尝试的从侧门解决一下问题，看如下代码</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">        <span class="keyword">public</span> <span class="function">MyHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">            View view = LayoutInflater.from(mContext).inflate(R.layout.item_list, <span class="keyword">null</span>);</div><div class="line">            view.setLayoutParams(<span class="keyword">new</span> FrameLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT));</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MyHolder(view);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>我手动为其设置了LayoutParams，结果如何呢？如下</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2651056-283dc99b6230ecd9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>一样的。</p>
<h3 id="为什么失效之后又是wrap-content呢？"><a href="#为什么失效之后又是wrap-content呢？" class="headerlink" title="为什么失效之后又是wrap_content呢？"></a>为什么失效之后又是wrap_content呢？</h3><p>这是因为RecyclerView里面机制如果LayoutParams是空的会给一个默认的LayoutParams。以后有兴趣贴源码。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 只会生成View 并不会设置任何属性</span></div><div class="line">LayoutInflater.<span class="keyword">from</span>(mContext).inflate(R.layout.item_list, <span class="literal">null</span>);</div><div class="line"><span class="comment">// 如果parent不为空会为其生成LayoutParams属性，</span></div><div class="line"><span class="comment">// attchToRoot如果为flase则会将LayoutParams Set进去，如果为true，则会添加到root里面</span></div><div class="line">LayoutInflater.<span class="keyword">from</span>(mContext).inflate(R.layout.item_list,parent, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<h3 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h3><p>这种问题其实在开发中非常常见不过当时解决了之后并没有深究其原因实属不该。</p>
</div><div class="tags"><a href="/tags/Android/">Android</a></div><div class="post-nav"><a href="/2018/02/27/设计模式-代理模式/" class="pre">设计模式 代理模式</a><a href="/2018/02/25/设计模式-Builder模式/" class="next">设计模式 Builder模式</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Lift/" style="font-size: 15px;">Lift</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/08/Android动态替换Application的一些思考/">Android 所谓的动态替换Application的方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/06/Android-OkHttp网络请求的封装/">Android OkHttp网络请求的封装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/31/一些Android第三方Lib解析文章/">Android第三方库源码分析,以及Gradle学习资料(持续更新)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/27/设计模式-代理模式/">设计模式 代理模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/26/Android关于LayoutInflater加载布局导致布局宽高失效/">Android关于LayoutInflater加载布局导致布局宽高失效</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/25/设计模式-Builder模式/">设计模式 Builder模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/26/RxAndroid-常用操作符/">RxAndroid 常用操作符记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/22/Android-带箭头的指引tipLayout实现。/">Android 带三角形箭头头的指引TipLayout实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/01/First-Day/">First Day</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/12/AndroidStudio发布个人开源项目遇到的几个坑bintray/">Android studio发布个人开源项目至bintray</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://msdx.github.io./" title="貌似掉线" target="_blank">貌似掉线</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">酸菜.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>